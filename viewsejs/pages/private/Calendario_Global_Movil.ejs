<!DOCTYPE html>
<html lang="es-cl">

<head>
    <%- include('../../modulos/head.ejs'); %>
    <meta name="description" content="Cibervoluntarios de DUOC UC">
    <meta name="author" content="Tecbit">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <title>Cibervoluntarios</title>

    <style>
        #calendar {
            max-width: 1100px;
            min-height: 900px;
            margin: 0px auto;
        }
    </style>
    

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">
        <%- include('../../modulos/slidebar.ejs'); %>

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">
                <%- include('../../modulos/navbar.ejs'); %>
                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <div class="row">
                        <div class="col mb-2">
                            <div class="card py-1 border-bottom-secondary d-flex justify-content-center">
                                <div class="card-body">
                                    <div id='calendar'></div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <%- include('../../modulos/footer.ejs'); %>

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.19/locales/es.global.js"></script>
    
    <%- include('../../modulos/scripts_globales.ejs'); %>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'listWeek',
            initialDate: '2025-08-07',
            headerToolbar: {
            left: 'prev,next',
            center: 'title',
            right: 'listWeek'
            },
            
            navLinks: true,
            locale: 'es',
            events: [

            <% Eventos.forEach(Evento => {
                %>{
                    title: '<%=Evento.Nombre %>',
                    start: '<%=new Date(Evento.Fecha_Inicio_RAW).toISOString() %>',
                    end:'<%=new Date(Evento.Fecha_Termino_RAW).toISOString() %>',
                    organizador:{
                        Nombre:'<%=Evento.Nombre_Responsable %>',
                        Correo:'<%=Evento.Correo_Responsable %>',
                        Rol:'<%=Evento.Rol %>'
                    },
                    Ubicacion:'<%=Evento.Ubicacion %>'
                    ,
                    Codigo:'<%=Evento.Code %>',
                    Sede:{
                        Codigo:'<%=Evento.Id_Sede %>',
                        Nombre:'<%=Evento.Sede_Organizadora %>'
                    },
                    publico:{
                        Capacidad:'<%=Evento.Capacidad %>',
                        Inscritos:'<%=Evento.Inscritos %>',
                        
                    },
                    activo: '<%=Evento.Registro_Activo %>',
                    intersede:'<%=Evento.Intersede %>',

                },
                
                <%});%>
            ],
            
            eventClick: function(calEvent) {
                const evento = calEvent.event;
                const evento_objeto = {
                        Nombre: evento.title,
                        fecha_inicio: evento.start,
                        fecha_termino: evento.end,
                        ...evento.extendedProps
                    };
                 Swal.fire({
                    title: evento_objeto.Nombre,
                    html: `
                        <div style="text-align:left;">
                            <p><b>📅 Fecha inicio:</b> ${new Date(evento_objeto.fecha_inicio).toLocaleString("es-CL")}</p>
                            <p><b>📅 Fecha término:</b> ${new Date(evento_objeto.fecha_termino).toLocaleString("es-CL")}</p>
                            <p><b>📍 Ubicación:</b> ${evento_objeto.Ubicacion || "Sin ubicación"}</p>
                            <p><b>👤 Organizador:</b> ${evento_objeto.organizador?.Nombre || ""} (${evento_objeto.organizador?.Correo || ""})</p>
                            <p><b>🏫 Sede:</b> ${evento_objeto.Sede?.Nombre || ""}</p>
                            <p><b>👥 Participación:</b> ${evento_objeto.publico?.Inscritos || 0} inscritos / ${evento_objeto.publico?.Capacidad || 0} cupos</p>
                        </div>
                    `,
                    icon: "info",
                    showCancelButton: true,
                    confirmButtonText: "Inscribirse",
                    cancelButtonText: "Cerrar",
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Redirigir a inscripción
                        window.location.href = "/inscripcion/" + evento_objeto.Codigo;
                    }
                });   
                }
            });

            calendar.render();
        });
    </script>

</body>

</html>